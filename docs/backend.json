{
  "entities": {
    "Raffle": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Raffle",
      "type": "object",
      "description": "Represents a raffle event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Raffle entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the raffle."
        },
        "description": {
          "type": "string",
          "description": "Description of the raffle."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the raffle image.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Price of a single ticket for the raffle."
        },
        "totalTickets": {
          "type": "number",
          "description": "Total number of tickets available for the raffle."
        },
        "endDate": {
          "type": "string",
          "description": "End date of the raffle.",
          "format": "date-time"
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates whether the raffle is currently active."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "price",
        "totalTickets",
        "endDate",
        "isActive"
      ]
    },
    "Ticket": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Ticket",
      "type": "object",
      "description": "Represents a ticket for a raffle.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Ticket entity."
        },
        "ticketNumber": {
          "type": "number",
          "description": "The ticket number."
        },
        "status": {
          "type": "string",
          "description": "Status of the ticket (available, reserved, paid)."
        },
        "purchaserName": {
          "type": "string",
          "description": "Name of the ticket purchaser."
        },
        "purchaserPhoneNumber": {
          "type": "string",
          "description": "Phone number of the ticket purchaser."
        },
        "raffleId": {
          "type": "string",
          "description": "Reference to Raffle. (Relationship: Raffle 1:N Ticket)"
        },
        "purchaseDate": {
          "type": "string",
          "description": "Date when the ticket was purchased.",
          "format": "date-time"
        },
        "isPaid": {
          "type": "boolean",
          "description": "Indicates whether the ticket has been paid for."
        }
      },
      "required": [
        "id",
        "ticketNumber",
        "status",
        "purchaserName",
        "purchaserPhoneNumber",
        "raffleId",
        "purchaseDate",
        "isPaid"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/raffles/{raffleId}",
        "definition": {
          "entityName": "Raffle",
          "schema": {
            "$ref": "#/backend/entities/Raffle"
          },
          "description": "Stores raffle information. Admins can create, read, update, and delete raffles. Users can read raffle information.",
          "params": [
            {
              "name": "raffleId",
              "description": "Unique identifier for the raffle."
            }
          ]
        }
      },
      {
        "path": "/raffles/{raffleId}/tickets/{ticketId}",
        "definition": {
          "entityName": "Ticket",
          "schema": {
            "$ref": "#/backend/entities/Ticket"
          },
          "description": "Stores tickets associated with a specific raffle. Includes denormalized 'raffleId' for authorization independence. Users can purchase tickets, and admins can manage ticket status.",
          "params": [
            {
              "name": "raffleId",
              "description": "Unique identifier for the raffle."
            },
            {
              "name": "ticketId",
              "description": "Unique identifier for the ticket."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "roles_admin",
          "schema": {
            "$ref": "#/backend/entities/user"
          },
          "description": "Indicates admin privileges. Existence of a document with the user's UID grants admin access to create, update, and delete raffles.",
          "params": [
            {
              "name": "uid",
              "description": "User's unique ID."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Sorteum Digital application, focusing on raffles and ticket management. It emphasizes authorization independence, clarity, and scalability. Raffles are stored in a top-level `raffles` collection, and tickets are stored as subcollections under each raffle document to ensure easy querying and data isolation. Admin roles are managed through a dedicated `roles_admin` collection. The structure ensures Authorization Independence via Denormalization by including key attributes like the raffle ID in each ticket document. This eliminates the need for security rules to traverse up the hierarchy to validate access. The structure also supports the required QAPs by segregating raffle data from ticket data and using path-based ownership for tickets within the respective raffle. Raffle management is restricted to admins via the `/roles_admin/{uid}` collection, while ticket purchases are controlled by rules at the `/raffles/{raffleId}/tickets/{ticketId}` level."
  }
}